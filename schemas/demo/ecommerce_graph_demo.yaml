name: ecommerce_analytics
version: "1.0"
description: "E-commerce platform graph analysis - Demo version"

graph_schema:
  nodes:
    - label: Customer
      database: brahmand
      table: customers_mem
      node_id: customer_id  # this implies customer_id: customer_id for the property mapping
      property_mappings:
        email: email
        name: "concat(first_name, ' ', last_name)"
        first_name: first_name
        last_name: last_name
        age: age
        gender: gender
        country: country
        city: city
        registration_date: registration_date
        total_spent: total_spent
        is_premium: is_premium
        filters:
          - "customer_id > 0"
          
    - label: Product
      database: brahmand
      table: products_mem
      node_id: product_id
      property_mappings:
        name: name
        category: category
        brand: brand
        price: price
        rating: rating
        num_reviews: num_reviews
        in_stock: in_stock
        created_date: created_date
        filters:
          - "in_stock = 1"
          
    - label: Order
      database: brahmand
      table: orders_mem
      node_id: order_id
      property_mappings:
        quantity: quantity
        unit_price: unit_price
        total_amount: total_amount
        order_date: order_date
        order_time: order_time
        status: status
        filters:
          - "status != 'cancelled'"
          
    - label: Review
      database: brahmand
      table: reviews_mem
      node_id: review_id
      property_mappings:
        rating: rating
        review_text: review_text
        review_date: review_date
        helpful_votes: helpful_votes
        
  edges:
    - type: PURCHASED
      database: brahmand
      table: orders_mem
      from_id: customer_id
      to_id: product_id
      type_name: PURCHASED
      from_node: Customer
      to_node: Product
      property_mappings:
        quantity: quantity
        amount: total_amount
        date: order_date
        status: status
        filters:
          - "status IN ('shipped', 'delivered')"
          
    - type: PLACED_ORDER
      database: brahmand
      table: orders_mem
      from_id: customer_id
      to_id: order_id
      from_node: Customer
      to_node: Order
      property_mappings:
        date: order_date
          
    - type: ORDER_CONTAINS
      database: brahmand
      table: orders_mem
      from_id: order_id
      to_id: product_id
      from_node: Order
      to_node: Product
      property_mappings:
        quantity: quantity
        unit_price: unit_price
        
    - type: REVIEWED
      database: brahmand
      table: reviews_mem
      from_id: customer_id
      to_id: product_id
      from_node: Customer
      to_node: Product
      property_mappings:
        rating: rating
        review_text: review_text
        date: review_date
        helpful_votes: helpful_votes