# Unified Test Schema for ClickGraph Integration Tests
#
# This schema consolidates test entities from:
# - social_benchmark (brahmand DB) - wiki tests, primary test suite
# - LDBC SNB (ldbc DB) - LDBC benchmark tests
# - OnTime flights (ontime DB) - flight benchmark tests
# - test_integration (test_integration DB) - dynamic test fixtures
#
# All entities coexist in one unified graph schema (single namespace).
# Label conflicts avoided by using descriptive names (User vs TestUser)
#
# Benefits:
# - Single GRAPH_CONFIG_PATH - no environment variable juggling
# - All tests use same schema - no schema mismatches
# - Different databases/tables provide clear separation
# - Simplified test infrastructure
#
# Usage: Tests just query the appropriate labels
#   MATCH (u:User) ...           → brahmand.users_bench (wiki tests)
#   MATCH (t:TestUser) ...       → test_integration.users (fixture tests)
#   MATCH (p:Person) ...         → ldbc.Person (LDBC tests)
#   MATCH (f:Flight) ...         → ontime.ontime (flight tests)

name: unified_test_schema

graph_schema:
  nodes:
    # ===================================================================================
    # SOCIAL BENCHMARK - Primary test suite (tests/integration/wiki/, most tests)
    # ===================================================================================
    - label: User
      database: brahmand
      table: users_bench
      node_id: user_id
      property_mappings:
        user_id: user_id
        name: full_name           # Cypher: u.name → SQL: full_name
        email: email_address      # Cypher: u.email → SQL: email_address
        registration_date: registration_date
        is_active: is_active
        country: country
        city: city

    - label: Post
      database: brahmand
      table: posts_bench
      node_id: post_id
      property_mappings:
        post_id: post_id
        content: content
        date: created_at

    - label: ZeekLog
      database: brahmand
      table: zeek_logs
      node_id: log_id
      property_mappings:
        log_id: log_id
        timestamp: timestamp
        source_ip: source_ip
        dest_ips: dest_ips
        protocols: protocols
        bytes_sent: bytes_sent

    # ===================================================================================
    # LDBC SNB - LDBC Social Network Benchmark (tests/integration/ldbc/)
    # ===================================================================================
    - label: Person
      database: ldbc
      table: Person
      node_id: id
      property_mappings:
        id: id
        firstName: firstName
        lastName: lastName
        gender: gender
        birthday: birthday
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed

    - label: Comment
      database: ldbc
      table: Comment
      node_id: id
      property_mappings:
        id: id
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed
        content: content
        length: length

    - label: Forum
      database: ldbc
      table: Forum
      node_id: id
      property_mappings:
        id: id
        title: title
        creationDate: creationDate

    - label: Tag
      database: ldbc
      table: Tag
      node_id: id
      property_mappings:
        id: id
        name: name
        url: url

    # ===================================================================================
    # ONTIME FLIGHTS - Flight data benchmark (tests/integration/ontime/)
    # ===================================================================================
    - label: Flight
      database: ontime
      table: ontime
      node_id: FlightNum
      property_mappings:
        FlightNum: FlightNum
        Year: Year
        Month: Month
        DayofMonth: DayofMonth
        Origin: Origin
        Dest: Dest
        DepTime: DepTime
        ArrTime: ArrTime
        DepDelay: DepDelay
        ArrDelay: ArrDelay
        Distance: Distance
        Cancelled: Cancelled

    # ===================================================================================
    # TEST_INTEGRATION - Dynamic test fixtures (tests/integration/test_*.py)
    # Uses TestUser/TestProduct to avoid conflicts with social_benchmark User
    # ===================================================================================
    - label: TestUser
      database: test_integration
      table: users
      node_id: user_id
      property_mappings:
        user_id: user_id
        name: name
        age: age

    - label: TestProduct
      database: test_integration
      table: products
      node_id: product_id
      property_mappings:
        product_id: product_id
        name: name
        price: price
        category: category

    - label: TestGroup
      database: test_integration
      table: groups
      node_id: id
      property_mappings:
        id: id
        name: name
        description: description

    # ===================================================================================
    # DENORMALIZED FLIGHTS - Virtual node pattern (tests/integration/test_denormalized_*.py)
    # ===================================================================================
    - label: Airport
      database: test_integration
      table: flights
      node_id: code
      property_mappings: {}
      
      from_node_properties:
        code: Origin
        city: OriginCityName
        state: OriginState
      
      to_node_properties:
        code: Dest
        city: DestCityName
        state: DestState

    # ===================================================================================
    # PATTERN COMPREHENSION TESTS (tests/integration/test_pattern_comprehensions.py)
    # ===================================================================================
    - label: PatternCompUser
      database: brahmand
      table: pattern_comp_users
      node_id: user_id
      property_mappings:
        user_id: user_id
        name: full_name
        country: country
        city: city

  edges:
    # ===================================================================================
    # SOCIAL BENCHMARK relationships
    # ===================================================================================
    - type: FOLLOWS
      database: brahmand
      table: user_follows_bench
      from_id: follower_id
      to_id: followed_id
      edge_id: follow_id
      from_node: User
      to_node: User
      property_mappings:
        follow_date: follow_date
    
    - type: AUTHORED
      database: brahmand
      table: posts_bench
      from_id: author_id
      to_id: post_id
      edge_id: post_id
      from_node: User
      to_node: Post
      property_mappings:
        post_date: post_date
    
    - type: LIKED
      database: brahmand
      table: post_likes_bench
      from_id: user_id
      to_id: post_id
      from_node: User
      to_node: Post
      property_mappings:
        like_date: like_date

    - type: FRIENDS_WITH
      database: brahmand
      table: friendships
      from_id: user1_id
      to_id: user2_id
      edge_id: friendship_id
      from_node: User
      to_node: User

    # ===================================================================================
    # LDBC SNB relationships
    # ===================================================================================
    - type: KNOWS
      database: ldbc
      table: Person_knows_Person
      from_id: Person1Id
      to_id: Person2Id
      from_node: Person
      to_node: Person
      property_mappings:
        creationDate: creationDate

    - type: HAS_CREATOR
      database: ldbc
      table: Comment_hasCreator_Person
      from_id: CommentId
      to_id: PersonId
      from_node: Comment
      to_node: Person

    - type: LIKES
      database: ldbc
      table: Person_likes_Post
      from_id: PersonId
      to_id: PostId
      from_node: Person
      to_node: Post
      property_mappings:
        creationDate: creationDate

    - type: CONTAINER_OF
      database: ldbc
      table: Forum_containerOf_Post
      from_id: ForumId
      to_id: PostId
      from_node: Forum
      to_node: Post

    - type: HAS_TAG
      database: ldbc
      table: Comment_hasTag_Tag
      from_id: CommentId
      to_id: TagId
      from_node: Comment
      to_node: Tag

    # ===================================================================================
    # ONTIME FLIGHTS relationships
    # ===================================================================================
    # ONTIME FLIGHTS relationships
    # ===================================================================================
    - type: FLIES_TO
      database: ontime
      table: ontime
      from_id: Origin
      to_id: Dest
      from_node: Flight
      to_node: Flight
      property_mappings:
        Distance: Distance
        ArrDelay: ArrDelay

    # ===================================================================================
    # TEST_INTEGRATION relationships (dynamic test fixtures)
    # ===================================================================================
    - type: TEST_FOLLOWS
      database: test_integration
      table: follows
      from_id: follower_id
      to_id: followed_id
      from_node: TestUser
      to_node: TestUser
      property_mappings:
        since: since

    - type: TEST_PURCHASED
      database: test_integration
      table: purchases
      from_id: user_id
      to_id: product_id
      from_node: TestUser
      to_node: TestProduct
      property_mappings:
        purchase_date: purchase_date
        quantity: quantity

    - type: TEST_FRIENDS_WITH
      database: test_integration
      table: friendships
      from_id: user_id_1
      to_id: user_id_2
      from_node: TestUser
      to_node: TestUser
      property_mappings:
        since: since

    # ===================================================================================
    # GROUP MEMBERSHIP - Simple User->Group pattern (tests/integration/matrix/)
    # Non-polymorphic junction table pattern for testing basic graph queries
    # ===================================================================================
    - type: MEMBER_OF
      database: test_integration
      table: memberships
      from_id: user_id
      to_id: group_id
      edge_id: [user_id, group_id]
      from_node: TestUser
      to_node: TestGroup
      property_mappings:
        joined_at: joined_at
        role: role

    # ===================================================================================
    # PATTERN COMPREHENSION TESTS (tests/integration/test_pattern_comprehensions.py)
    # ===================================================================================
    - type: PATTERN_COMP_FOLLOWS
      database: brahmand
      table: pattern_comp_follows
      from_id: follower_id
      to_id: followed_id
      from_node: PatternCompUser
      to_node: PatternCompUser
      property_mappings:
        follow_date: follow_date

    # ===================================================================================

