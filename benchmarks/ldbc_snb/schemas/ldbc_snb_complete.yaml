# LDBC SNB Interactive v1 Schema for ClickGraph
# Maps LDBC CSV data loaded into ClickHouse to a graph model

name: ldbc_snb

graph_schema:
  # ===========================================================================
  # NODES
  # ===========================================================================
  nodes:
    # -------------------------------------------------------------------------
    # Person - central node type in the social network
    # -------------------------------------------------------------------------
    - label: Person
      database: ldbc
      table: Person
      node_id: id
      property_mappings:
        id: id
        firstName: firstName
        lastName: lastName
        gender: gender
        birthday: birthday
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed
        # speaks and email are arrays - available but may need special handling

    # -------------------------------------------------------------------------
    # Post - content created by a Person in a Forum
    # -------------------------------------------------------------------------
    - label: Post
      database: ldbc
      table: Post
      node_id: id
      property_mappings:
        id: id
        imageFile: imageFile
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed
        language: language
        content: content
        length: length

    # -------------------------------------------------------------------------
    # Comment - reply to a Post or another Comment
    # -------------------------------------------------------------------------
    - label: Comment
      database: ldbc
      table: Comment
      node_id: id
      property_mappings:
        id: id
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed
        content: content
        length: length

    # -------------------------------------------------------------------------
    # Message - unified view of Post and Comment (virtual label)
    # Note: Uses the Message view that unions Post and Comment
    # The 'type' column distinguishes between 'Post' and 'Comment'
    # -------------------------------------------------------------------------
    - label: Message
      database: ldbc
      table: Message
      node_id: id
      label_column: type  # Polymorphic: type='Post' or type='Comment'
      property_mappings:
        id: id
        creationDate: creationDate
        locationIP: locationIP
        browserUsed: browserUsed
        content: content
        length: length
        imageFile: imageFile
        language: language
        type: type

    # -------------------------------------------------------------------------
    # Forum - container for Posts
    # -------------------------------------------------------------------------
    - label: Forum
      database: ldbc
      table: Forum
      node_id: id
      property_mappings:
        id: id
        title: title
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Tag - categorization for content
    # -------------------------------------------------------------------------
    - label: Tag
      database: ldbc
      table: Tag
      node_id: id
      property_mappings:
        id: id
        name: name
        url: url

    # -------------------------------------------------------------------------
    # TagClass - hierarchical classification of Tags
    # -------------------------------------------------------------------------
    - label: TagClass
      database: ldbc
      table: TagClass
      node_id: id
      property_mappings:
        id: id
        name: name
        url: url

    # -------------------------------------------------------------------------
    # Place - geographic location (City, Country, Continent)
    # -------------------------------------------------------------------------
    - label: Place
      database: ldbc
      table: Place
      node_id: id
      property_mappings:
        id: id
        name: name
        url: url
        type: type

    # -------------------------------------------------------------------------
    # Specific place types (using same table with type filter)
    # Note: For queries that specifically need City/Country/Continent
    # -------------------------------------------------------------------------
    - label: City
      database: ldbc
      table: Place
      node_id: id
      filter: "type = 'City'"
      property_mappings:
        id: id
        name: name
        url: url

    - label: Country
      database: ldbc
      table: Place
      node_id: id
      filter: "type = 'Country'"
      property_mappings:
        id: id
        name: name
        url: url

    - label: Continent
      database: ldbc
      table: Place
      node_id: id
      filter: "type = 'Continent'"
      property_mappings:
        id: id
        name: name
        url: url

    # -------------------------------------------------------------------------
    # Organisation - University or Company
    # -------------------------------------------------------------------------
    - label: Organisation
      database: ldbc
      table: Organisation
      node_id: id
      property_mappings:
        id: id
        name: name
        url: url
        type: type

    - label: University
      database: ldbc
      table: Organisation
      node_id: id
      filter: "type = 'University'"
      property_mappings:
        id: id
        name: name
        url: url

    - label: Company
      database: ldbc
      table: Organisation
      node_id: id
      filter: "type = 'Company'"
      property_mappings:
        id: id
        name: name
        url: url

  # ===========================================================================
  # RELATIONSHIPS
  # ===========================================================================
  edges:
    # -------------------------------------------------------------------------
    # Person KNOWS Person (friendship, bidirectional)
    # -------------------------------------------------------------------------
    - type: KNOWS
      database: ldbc
      table: Person_knows_Person
      from_id: Person1Id
      to_id: Person2Id
      from_node: Person
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person IS_LOCATED_IN Place (city where person lives)
    # -------------------------------------------------------------------------
    - type: IS_LOCATED_IN
      database: ldbc
      table: Person_isLocatedIn_Place
      from_id: PersonId
      to_id: CityId
      from_node: Person
      to_node: City
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person HAS_INTEREST Tag
    # -------------------------------------------------------------------------
    - type: HAS_INTEREST
      database: ldbc
      table: Person_hasInterest_Tag
      from_id: PersonId
      to_id: TagId
      from_node: Person
      to_node: Tag
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person STUDY_AT Organisation (university)
    # -------------------------------------------------------------------------
    - type: STUDY_AT
      database: ldbc
      table: Person_studyAt_Organisation
      from_id: PersonId
      to_id: UniversityId
      from_node: Person
      to_node: University
      property_mappings:
        classYear: classYear
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person WORK_AT Organisation (company)
    # -------------------------------------------------------------------------
    - type: WORK_AT
      database: ldbc
      table: Person_workAt_Organisation
      from_id: PersonId
      to_id: CompanyId
      from_node: Person
      to_node: Company
      property_mappings:
        workFrom: workFrom
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person LIKES Post
    # -------------------------------------------------------------------------
    - type: LIKES
      database: ldbc
      table: Person_likes_Post
      from_id: PersonId
      to_id: PostId
      from_node: Person
      to_node: Post
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person LIKES Comment
    # -------------------------------------------------------------------------
    - type: LIKES
      database: ldbc
      table: Person_likes_Comment
      from_id: PersonId
      to_id: CommentId
      from_node: Person
      to_node: Comment
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Person LIKES Message (unified view)
    # -------------------------------------------------------------------------
    - type: LIKES
      database: ldbc
      table: Person_likes_Message
      from_id: PersonId
      to_id: MessageId
      from_node: Person
      to_node: Message
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Message HAS_CREATOR Person (unified view for polymorphic Message node)
    # -------------------------------------------------------------------------
    - type: HAS_CREATOR
      database: ldbc
      table: Message_hasCreator_Person
      from_id: MessageId
      to_id: PersonId
      from_node: Message
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Post HAS_CREATOR Person (specific - use HAS_CREATOR for Message queries)
    # -------------------------------------------------------------------------
    - type: HAS_CREATOR
      database: ldbc
      table: Post_hasCreator_Person
      from_id: PostId
      to_id: PersonId
      from_node: Post
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Comment HAS_CREATOR Person
    # -------------------------------------------------------------------------
    - type: HAS_CREATOR
      database: ldbc
      table: Comment_hasCreator_Person
      from_id: CommentId
      to_id: PersonId
      from_node: Comment
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Message HAS_CREATOR Person (unified view)
    # -------------------------------------------------------------------------
    - type: HAS_CREATOR
      database: ldbc
      table: Message_hasCreator_Person
      from_id: MessageId
      to_id: PersonId
      from_node: Message
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Comment REPLY_OF Post
    # -------------------------------------------------------------------------
    - type: REPLY_OF
      database: ldbc
      table: Comment_replyOf_Post
      from_id: CommentId
      to_id: PostId
      from_node: Comment
      to_node: Post
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Comment REPLY_OF Comment
    # -------------------------------------------------------------------------
    - type: REPLY_OF
      database: ldbc
      table: Comment_replyOf_Comment
      from_id: Comment1Id
      to_id: Comment2Id
      from_node: Comment
      to_node: Comment
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Comment REPLY_OF Message (unified view for polymorphic Message queries)
    # This allows queries like (message:Message)<-[:REPLY_OF]-(comment:Comment)
    # Uses Comment_replyOf_Message view which unions Post and Comment replies
    # -------------------------------------------------------------------------
    - type: REPLY_OF
      database: ldbc
      table: Comment_replyOf_Message
      from_id: CommentId
      to_id: MessageId
      from_node: Comment
      to_node: Message
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Message REPLY_OF Message (unified view for VLP queries)
    # This allows queries like (m:Message)-[:REPLY_OF*0..]->(p:Message)
    # Uses Message_replyOf_Message view which handles polymorphic traversal
    # -------------------------------------------------------------------------
    - type: REPLY_OF
      database: ldbc
      table: Message_replyOf_Message
      from_id: MessageId
      to_id: TargetMessageId
      from_node: Message
      to_node: Message
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Forum CONTAINER_OF Post
    # -------------------------------------------------------------------------
    - type: CONTAINER_OF
      database: ldbc
      table: Forum_containerOf_Post
      from_id: ForumId
      to_id: PostId
      from_node: Forum
      to_node: Post
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Forum HAS_MODERATOR Person
    # -------------------------------------------------------------------------
    - type: HAS_MODERATOR
      database: ldbc
      table: Forum_hasModerator_Person
      from_id: ForumId
      to_id: PersonId
      from_node: Forum
      to_node: Person
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Forum HAS_MEMBER Person
    # -------------------------------------------------------------------------
    - type: HAS_MEMBER
      database: ldbc
      table: Forum_hasMember_Person
      from_id: ForumId
      to_id: PersonId
      from_node: Forum
      to_node: Person
      property_mappings:
        creationDate: creationDate
        joinDate: joinDate

    # -------------------------------------------------------------------------
    # Message HAS_TAG Tag (unified view for polymorphic Message node)
    # This is the proper relationship for (Message)-[:HAS_TAG]->(Tag) queries
    # Uses Message_hasTag_Tag view which unions Post and Comment edges
    # -------------------------------------------------------------------------
    - type: HAS_TAG
      database: ldbc
      table: Message_hasTag_Tag
      from_id: MessageId
      to_id: TagId
      from_node: Message
      to_node: Tag
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Forum HAS_TAG Tag
    # -------------------------------------------------------------------------
    - type: HAS_TAG
      database: ldbc
      table: Forum_hasTag_Tag
      from_id: ForumId
      to_id: TagId
      from_node: Forum
      to_node: Tag
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Post HAS_TAG Tag
    # -------------------------------------------------------------------------
    - type: HAS_TAG
      database: ldbc
      table: Post_hasTag_Tag
      from_id: PostId
      to_id: TagId
      from_node: Post
      to_node: Tag
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Comment HAS_TAG Tag
    # -------------------------------------------------------------------------
    - type: HAS_TAG
      database: ldbc
      table: Comment_hasTag_Tag
      from_id: CommentId
      to_id: TagId
      from_node: Comment
      to_node: Tag
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Tag HAS_TYPE TagClass
    # -------------------------------------------------------------------------
    - type: HAS_TYPE
      database: ldbc
      table: Tag_hasType_TagClass
      from_id: TagId
      to_id: TagClassId
      from_node: Tag
      to_node: TagClass

    # -------------------------------------------------------------------------
    # TagClass IS_SUBCLASS_OF TagClass
    # -------------------------------------------------------------------------
    - type: IS_SUBCLASS_OF
      database: ldbc
      table: TagClass_isSubclassOf_TagClass
      from_id: TagClass1Id
      to_id: TagClass2Id
      from_node: TagClass
      to_node: TagClass

    # -------------------------------------------------------------------------
    # Place IS_PART_OF Place (City -> Country -> Continent)
    # -------------------------------------------------------------------------
    - type: IS_PART_OF
      database: ldbc
      table: Place_isPartOf_Place
      from_id: Place1Id
      to_id: Place2Id
      from_node: Place
      to_node: Place

    # -------------------------------------------------------------------------
    # Organisation IS_LOCATED_IN Place
    # -------------------------------------------------------------------------
    - type: IS_LOCATED_IN
      database: ldbc
      table: Organisation_isLocatedIn_Place
      from_id: OrganisationId
      to_id: PlaceId
      from_node: Organisation
      to_node: Place

    # -------------------------------------------------------------------------
    # Post IS_LOCATED_IN Place
    # NOTE: Post_isLocatedIn_Place has bad data, use Post_isLocatedIn_Country instead
    # -------------------------------------------------------------------------
    - type: IS_LOCATED_IN
      database: ldbc
      table: Post_isLocatedIn_Country
      from_id: PostId
      to_id: CountryId
      from_node: Post
      to_node: Country
      property_mappings:
        creationDate: creationDate

    # -------------------------------------------------------------------------
    # Post POST_LOCATED_IN Country (for IC3 query)
    # -------------------------------------------------------------------------
    - type: IS_LOCATED_IN
      database: ldbc
      table: Post_isLocatedIn_Country
      from_id: PostId
      to_id: CountryId
      from_node: Post
      to_node: Country

    # -------------------------------------------------------------------------
    # Comment IS_LOCATED_IN Place
    # NOTE: Comment_isLocatedIn_Place has bad data, use Comment_isLocatedIn_Country instead
    # -------------------------------------------------------------------------
    - type: IS_LOCATED_IN
      database: ldbc
      table: Comment_isLocatedIn_Country
      from_id: CommentId
      to_id: CountryId
      from_node: Comment
      to_node: Country
      property_mappings:
        creationDate: creationDate
