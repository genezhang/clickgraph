name: Auto Approve & Auto Merge

on:
  pull_request_target:
    types: [opened, synchronize, reopened]
  status: {}

jobs:
  auto-approve:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
      statuses: read

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v41
      with:
        files: |
          **/*.md
          **/*.yml
          **/*.yaml
          docs/**
          .github/**

    - name: Auto-approve documentation/formatting changes
      if: steps.changed-files.outputs.only_changed == 'true'
      uses: juliangruber/approve-pull-request-action@v2
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        number: ${{ github.event.pull_request.number }}
        body: |
          ü§ñ Auto-approved because this PR only contains:

          - üìù Documentation changes (`.md` files)
          - ‚öôÔ∏è Configuration changes (`.yml`/`.yaml` files)
          - ÔøΩ CI/CD changes (`.github/` directory)

          These changes are safe to merge automatically.

  auto-merge:
    runs-on: ubuntu-latest
    needs: auto-approve
    permissions:
      pull-requests: write
      contents: write

    steps:
    - name: Auto-merge approved PRs
      uses: peter-evans/enable-pull-request-automerge@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        pull-request-number: ${{ github.event.pull_request.number }}
        merge-method: squash